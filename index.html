<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>For Elly 💌</title>

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

  <!-- Main Styles -->
  <style>
    :root {
      --pink-light: #ffb6c1;
      --pink: #ff69b4;
      --pink-dark: #c94e68;
      --bg-light: rgba(255, 248, 248, 0.95);
      --bg-overlay: rgba(255,255,255,0.9);
      --text-dark: #333;
      --radius: 12px;
      --transition: 0.3s ease;
      --bg-color: var(--bg-overlay);
      --text-color: var(--text-dark);
    }
    [data-theme="dark"] {
      --bg-color: #2c2c2c;
      --text-color: #eee;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      height: 100%; font-family: 'Poppins', sans-serif;
      background: url('https://amsterdamian.com/wp-content/uploads/2021/03/tulips-7jpg_s.jpg') no-repeat center center fixed;
      background-size: cover; scroll-behavior: smooth; overflow-x: hidden;
      color: var(--text-color);
    }
    header {
      position: fixed; top: 0; width: 100%; transition: background var(--transition), transform var(--transition);
      background: var(--bg-color); backdrop-filter: blur(10px); z-index:1000;
    }
    header.scrolled { transform: translateY(-80%); }
    nav { max-width:1100px; margin:auto; display:flex; justify-content:center; gap:2rem; padding:0.5rem; }
    nav a { font-weight:500; color:var(--pink-dark); text-decoration:none; padding:0.5rem; border-radius:var(--radius); transition:var(--transition); }
    nav a.active, nav a:hover { background:var(--pink-light); color:#fff; }
    #themeToggle { position: absolute; right:1rem; top:1rem; background:none; border:none; cursor:pointer; font-size:1.2em; }

    main { padding-top:4rem; }
    .screen { display:none; padding:6rem 1rem 1rem; justify-content:center; align-items:flex-start; text-align:center; }
    .screen.active { display:flex; }
    h1 { font-size:2.5em; color:var(--pink-dark); margin-bottom:0.5em; }

    /* Home */
    .intro h1 { font-family:'Pacifico', cursive; color:#ffeef2; font-size:3.5em; text-shadow:2px 2px 6px rgba(0,0,0,0.4); animation:bounce 1.5s infinite alternate; }
    .intro button { padding:14px 36px; font-size:1.3em; background:linear-gradient(to right,var(--pink-light),var(--pink)); color:#fff; border:none; border-radius:30px; cursor:pointer; box-shadow:0 8px 20px rgba(255,105,180,0.4); animation:pulse 2s infinite; transition:transform .2s; }
    .intro button:hover { transform:scale(1.05); }

    /* Anniversary */
    .overlay { background:var(--bg-color); padding:2rem; border-radius:var(--radius); max-width:800px; width:95%; max-height:85vh; overflow-y:auto; box-shadow:0 8px 40px rgba(0,0,0,0.1); margin:auto; }
    #dayCounter { font-size:1.2em; margin-bottom:1em; color:var(--pink-dark); }
    #typedText { font-size:1.2em; line-height:1.7; white-space:pre-wrap; opacity:0; transition:opacity 1s ease; min-height:150px; margin-bottom:2rem; color:var(--pink-dark); }

    /* Gallery & Lightbox */
    .gallery { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:1rem; margin-bottom:2rem; }
    .photo-card { position:relative; border-radius:var(--radius); overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.2); transition:transform var(--transition); cursor:pointer; }
    .photo-card img { width:100%; height:200px; object-fit:cover; display:block; loading:lazy; }
    .photo-card:hover, .photo-card:focus { transform:scale(1.03); }
    .photo-card .caption { position:absolute; bottom:0; width:100%; background:var(--pink-light); color:#fff; padding:0.5rem; font-size:0.9em; }
    #lightbox { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:none; align-items:center; justify-content:center; z-index:2000; }
    #lightbox img { max-width:90%; max-height:80%; }
    #lightbox .close { position:absolute; top:2rem; right:2rem; font-size:2rem; color:#fff; cursor:pointer; }

    /* Q&A & Quiz */
    .question-section, .quiz-section { text-align:left; margin-bottom:2rem; }
    .question-section textarea { width:100%; padding:0.8rem; border:2px solid var(--pink); border-radius:var(--radius); resize:vertical; }
    .question-section button,.quiz-section button { margin-top:0.5rem; padding:0.6rem 1.2rem; background:var(--pink); color:#fff; border:none; border-radius:var(--radius); cursor:pointer; }
    .question-section button:hover,.quiz-section button:hover { background:var(--pink-dark); }
    #questionOutput { margin-top:1rem; font-style:italic; }
    .quiz-section form { display:flex; flex-direction:column; gap:0.5rem; }
    .quiz-section label { display:flex; align-items:center; gap:0.5rem; }
    .quiz-section input[type=radio] { accent-color:var(--pink); }
    #quizOutput { margin-top:1rem; font-weight:600; }
    .correct { color:green; }
    .incorrect { color:red; }

    /* Timeline */
    .timeline { display:flex; overflow-x:auto; gap:2rem; padding:1rem 0; }
    .timeline-item { flex:0 0 auto; background:var(--bg-light); padding:1rem; border-radius:var(--radius); min-width:200px; }

    /* Animations */
    @keyframes fadeIn { from{opacity:0;transform:translateY(20px);} to{opacity:1;transform:translateY(0);} }
    @keyframes bounce { 0%{transform:translateY(0);}100%{transform:translateY(-8px);} }
    @keyframes pulse { 0%{box-shadow:0 0 0 0 rgba(255,105,180,0.5);}70%{box-shadow:0 0 0 15px rgba(255,105,180,0);}100%{box-shadow:0;} }
  </style>
</head>
<body data-theme="light">
  <!-- Floating hearts -->
  <script>
    setInterval(() => {
      const heart = document.createElement('div');
      heart.className = 'heart';
      heart.innerHTML = '❤️';
      heart.style.position = 'fixed';
      heart.style.left = Math.random()*100 + 'vw';
      heart.style.top = Math.random()*100 + 'vh';
      document.body.appendChild(heart);
      heart.animate([{ transform: 'scale(1)', opacity: 1 }, { transform: 'scale(0)', opacity: 0 }], { duration: 2000 });
      setTimeout(() => heart.remove(), 2000);
    }, 800);
  </script>

  <!-- Background music with controls -->
  <div style="position:fixed; bottom:1rem; left:1rem; z-index:1000;">
    <button id="musicToggle">🔊</button>
    <audio id="bgMusic" loop>
      <source src="https://cdn.pixabay.com/download/audio/2023/03/26/audio_2f93402b08.mp3?filename=romantic-music-144109.mp3" type="audio/mp3">
    </audio>
  </div>

  <!-- Header -->
  <header role="banner">
    <nav role="navigation">
      <a href="#home" class="active" onclick="navigate(event,'home')" tabindex="0">Home</a>
      <a href="#anniversary" onclick="navigate(event,'anniversary')" tabindex="0">Letter</a>
      <a href="#questions" onclick="navigate(event,'questions')" tabindex="0">Questions</a>
    </nav>
    <button id="themeToggle" aria-label="Toggle theme">🌙</button>
  </header>

  <main>
    <!-- Home -->
    <section id="home" class="screen active" role="region" aria-labelledby="home-heading">
      <div class="intro">
        <h1 id="home-heading">For Elly 💌</h1>
        <button onclick="navigate(null,'anniversary')">Open</button>
      </div>
    </section>

    <!-- Anniversary -->
    <section id="anniversary" class="screen" role="region" aria-labelledby="ann-heading">
      <div class="overlay reveal">
        <p id="dayCounter" aria-live="polite"></p>
        <h1 id="ann-heading">Happy 7 Months, Elly 🌸</h1>
        <div id="typedText"></div>

        <!-- Timeline -->
        <div class="timeline">
          <div class="timeline-item">01/12/2023<br>First Date</div>
          <div class="timeline-item">14/02/2024<br>Valentine's Day</div>
          <div class="timeline-item">25/11/2024<br>Start of Us</div>
        </div>

        <!-- Gallery -->
        <div class="gallery" role="list">
          <!-- repeat photo-card items with loading="lazy" and tabindex -->
          <!-- ... -->
        </div>
      </div>
    </section>

    <!-- Questions -->
    <section id="questions" class="screen" role="region" aria-labelledby="qa-heading">
      <div class="overlay reveal">
        <div class="question-section">
          <h2 id="qa-heading">Ask Me Anything 💬</h2>
          <textarea id="questionInput" rows="4" placeholder="What's on your mind?..." aria-label="Your question"></textarea>
          <button onclick="submitQuestion()">Send</button>
          <div id="questionOutput"></div>
        </div>
        <div class="quiz-section">
          <h2>Quick Relationship Quiz 📖</h2>
          <form id="quizForm">
            <p>Where did we first meet?</p>
            <label><input type="radio" name="quiz" value="A"> Mall</label>
            <label><input type="radio" name="quiz" value="B"> Party</label>
            <label><input type="radio" name="quiz" value="C"> Online</label>
            <button type="button" onclick="submitQuiz()">Check Answer</button>
          </form>
          <div id="quizOutput" hidden></div>
          <div id="secretMsg" hidden><strong>Surprise! Can’t wait for our next adventure 🥰</strong></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Lightbox -->
  <div id="lightbox" role="dialog" aria-modal="true">
    <span class="close" aria-label="Close lightbox">×</span>
    <img src="" alt="Expanded photo">
  </div>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js');
      });
    }

    // Theme Toggle
    const themeBtn = document.getElementById('themeToggle');
    themeBtn.addEventListener('click', () => {
      const theme = document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      document.body.setAttribute('data-theme', theme);
      themeBtn.textContent = theme === 'dark' ? '☀️' : '🌙';
      localStorage.setItem('theme', theme);
    });
    // Load saved theme
    const saved = localStorage.getItem('theme');
    if (saved) document.body.setAttribute('data-theme', saved);

    // Music Toggle
    const music = document.getElementById('bgMusic'), mBtn = document.getElementById('musicToggle');
    mBtn.addEventListener('click', () => {
      if (music.paused) { music.play(); mBtn.textContent='🔇'; }
      else { music.pause(); mBtn.textContent='🔊'; }
    });

    // Scroll header
    let lastY = window.scrollY;
    window.addEventListener('scroll', () => {
      document.querySelector('header').classList.toggle('scrolled', window.scrollY > lastY);
      lastY = window.scrollY;
      document.querySelectorAll('.reveal').forEach(el => {
        if (el.getBoundingClientRect().top < window.innerHeight * 0.9) el.style.animation = 'fadeIn 0.6s forwards';
      });
    });

    // Lightbox logic
    document.querySelectorAll('.photo-card img').forEach(img => {
      img.addEventListener('click', () => {
        const lb = document.getElementById('lightbox');
        lb.querySelector('img').src = img.src;
        lb.style.display = 'flex';
      });
    });
    document.querySelector('#lightbox .close').addEventListener('click', () => {
      document.getElementById('lightbox').style.display = 'none';
    });

    // Typing effect & counters & quiz
    function startTyping(){ /* same as before */ }
    (function(){ /* dayCounter as before */ })();
    function submitQuestion(){ /* as before */ }
    function submitQuiz(){ /* on correct, reveal secretMsg */ }

    // Geolocation surprise
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        const { latitude, longitude } = pos.coords;
        // e.g., check if near specific coords, then show custom message
      });
    }
  </script>

</body>
</html>

<!--
Additional files to add:

**manifest.json**
```json
{
  "name": "For Elly",
  "short_name": "EllyApp",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffb6c1",
  "theme_color": "#ff69b4",
  "icons": [ { "src": "icon-192.png", "sizes": "192x192", "type": "image/png" } ]
}
```

**service-worker.js**
```js
self.addEventListener('install', e => {
  e.waitUntil(
    caches.open('elly-cache').then(cache => cache.addAll(['/', '/index.html', '/styles.css']))
  );
});
self.addEventListener('fetch', e => {
  e.respondWith(
    caches.match(e.request).then(r => r || fetch(e.request))
  );
});
```
-->
